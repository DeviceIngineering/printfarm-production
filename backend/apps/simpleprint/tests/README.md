# SimplePrint Tests - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤ –¥–ª—è SimplePrint –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–æ–π –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞.

## üß™ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

### 1. `test_client.py` - –¢–µ—Å—Ç—ã API –∫–ª–∏–µ–Ω—Ç–∞ (5 —Ç–µ—Å—Ç–æ–≤)

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç—É SimplePrint API –∫–ª–∏–µ–Ω—Ç–∞ (`apps/simpleprint/client.py`):

- **–¢–µ—Å—Ç 1**: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ `settings.py`
  - –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç API token, user_id, company_id, base_url

- **–¢–µ—Å—Ç 2**: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ API
  - –¢–µ—Å—Ç–∏—Ä—É–µ—Ç –º–µ—Ç–æ–¥ `test_connection()`
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç GET `/account/Test`

- **–¢–µ—Å—Ç 3**: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∏ –ø–∞–ø–æ–∫
  - –¢–µ—Å—Ç–∏—Ä—É–µ—Ç `get_files_and_folders()`
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç GET `/files/GetFiles`
  - –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ—Ç–≤–µ—Ç–∞

- **–¢–µ—Å—Ç 4**: Rate Limiting
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–±–ª—é–¥–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ 180 req/min
  - –ò–∑–º–µ—Ä—è–µ—Ç –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏

- **–¢–µ—Å—Ç 5**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
  - –¢–µ—Å—Ç–∏—Ä—É–µ—Ç retry –ª–æ–≥–∏–∫—É (3 –ø–æ–ø—ã—Ç–∫–∏)
  - –°–∏–º—É–ª–∏—Ä—É–µ—Ç 500 Server Error

### 2. `test_sync.py` - –¢–µ—Å—Ç—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (5 —Ç–µ—Å—Ç–æ–≤)

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–µ—Ä–≤–∏—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (`apps/simpleprint/services.py`):

- **–¢–µ—Å—Ç 1**: –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `SimplePrintSync.objects.create()`
  - –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î

- **–¢–µ—Å—Ç 2**: –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ API
  - –¢–µ—Å—Ç–∏—Ä—É–µ—Ç `fetch_all_files_and_folders_recursively()`
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞ API

- **–¢–µ—Å—Ç 3**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞–ø–æ–∫ –≤ –ë–î
  - –¢–µ—Å—Ç–∏—Ä—É–µ—Ç `_save_folders_to_db()`
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π

- **–¢–µ—Å—Ç 4**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –≤ –ë–î
  - –¢–µ—Å—Ç–∏—Ä—É–µ—Ç `_save_files_to_db()`
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–≤—è–∑–∏ —Å –ø–∞–ø–∫–∞–º–∏ (ForeignKey)

- **–¢–µ—Å—Ç 5**: –ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (E2E)
  - –¢–µ—Å—Ç–∏—Ä—É–µ—Ç `sync_all_files()`
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å end-to-end

### 3. `test_api.py` - –¢–µ—Å—Ç—ã API endpoints (4 —Ç–µ—Å—Ç–∞)

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç REST API endpoints (`apps/simpleprint/views.py`):

- **–¢–µ—Å—Ç 1**: POST `/api/v1/simpleprint/sync/trigger/`
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–ø—É—Å–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
  - –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç 202 ACCEPTED
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—ã–∑–æ–≤ Celery task

- **–¢–µ—Å—Ç 2**: GET `/api/v1/simpleprint/sync/status/{task_id}/`
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏
  - –¢–µ—Å—Ç–∏—Ä—É–µ—Ç –ø–æ–ª—è state, ready, result

- **–¢–µ—Å—Ç 3**: GET `/api/v1/simpleprint/sync/stats/`
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
  - –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç total_folders, total_files

- **–¢–µ—Å—Ç 4**: GET `/api/v1/simpleprint/files/`
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤
  - –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏—é –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É

## üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### –í–∞—Ä–∏–∞–Ω—Ç 1: –í—Å–µ —Ç–µ—Å—Ç—ã (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
cd backend
./run_tests.sh
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –û—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã

```bash
# –¢–æ–ª—å–∫–æ —Ç–µ—Å—Ç—ã –∫–ª–∏–µ–Ω—Ç–∞
pytest apps/simpleprint/tests/test_client.py -v -s

# –¢–æ–ª—å–∫–æ —Ç–µ—Å—Ç—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
pytest apps/simpleprint/tests/test_sync.py -v -s

# –¢–æ–ª—å–∫–æ —Ç–µ—Å—Ç—ã API
pytest apps/simpleprint/tests/test_api.py -v -s

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç
pytest apps/simpleprint/tests/test_client.py::TestSimplePrintClient::test_01_client_initialization -v -s
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ó–∞–ø—É—Å–∫ —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –æ–ø—Ü–∏—è–º–∏

```bash
# –° –≤—ã–≤–æ–¥–æ–º –ø–æ–∫—Ä—ã—Ç–∏—è –∫–æ–¥–∞
pytest apps/simpleprint/tests/ -v -s --cov=apps.simpleprint --cov-report=html

# –¢–æ–ª—å–∫–æ –±—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã (–±–µ–∑ integration)
pytest apps/simpleprint/tests/ -v -s -m "not slow"

# –° –æ—Å—Ç–∞–Ω–æ–≤–∫–æ–π –Ω–∞ –ø–µ—Ä–≤–æ–π –æ—à–∏–±–∫–µ
pytest apps/simpleprint/tests/ -v -s -x
```

## üìä –§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞

–ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç –≤—ã–≤–æ–¥–∏—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:

```
================================================================================
üîß –¢–ï–°–¢ 1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è SimplePrint –∫–ª–∏–µ–Ω—Ç–∞
================================================================================
üìã –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è SimplePrint:
   - API Token: 18f82f78f4... (–ø–µ—Ä–≤—ã–µ 10 —Å–∏–º–≤–æ–ª–æ–≤)
   - User ID: 31471
   - Company ID: 27286
   - Base URL: https://api.simplyprint.io/27286/
   - Rate Limit: 180 req/min

‚úÖ PASS: –ö–ª–∏–µ–Ω—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
   - API Token: ‚úì
   - User ID: ‚úì
   - Company ID: ‚úì
   - Base URL: ‚úì
```

–ü—Ä–∏ –æ—à–∏–±–∫–µ:

```
‚ùå FAIL: API –≤–µ—Ä–Ω—É–ª success=False. Response: {'status': 'error', 'message': 'Invalid token'}
üìç –§–∞–π–ª: backend/apps/simpleprint/client.py
üìç –ú–µ—Ç–æ–¥: test_connection()
üí° –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
   - –ù–µ–≤–µ—Ä–Ω—ã–π API —Ç–æ–∫–µ–Ω
   - API SimplePrint –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
   - –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π base_url
```

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: –¢–µ—Å—Ç—ã –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ pytest –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install pytest pytest-django

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DJANGO_SETTINGS_MODULE
export DJANGO_SETTINGS_MODULE=config.settings.base

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ backend
pwd  # –¥–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å .../Factory_v3/backend
```

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ PostgreSQL
docker-compose up -d db

# –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏
python manage.py migrate
```

### –ü—Ä–æ–±–ª–µ–º–∞: API SimplePrint –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `backend/config/settings/base.py`:

```python
SIMPLEPRINT_CONFIG = {
    'api_token': '–≤–∞—à_—Ç–æ–∫–µ–Ω',  # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å
    'user_id': '–≤–∞—à_user_id',
    'company_id': '–≤–∞—à_company_id',
    'base_url': 'https://api.simplyprint.io/COMPANY_ID/',  # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL
}
```

## üìù –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ –≤—ã —É–≤–∏–¥–∏—Ç–µ:

```
========================================
‚úÖ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´ –£–°–ü–ï–®–ù–û!
========================================

üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:
   ‚úì API Client: OK
   ‚úì Sync Service: OK
   ‚úì API Endpoints: OK
```

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–µ—Å—Ç–∞

1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º —Ñ–∞–π–ª–µ:

```python
def test_06_my_new_test(self, client):
    """
    ‚úÖ/‚ùå –¢–µ—Å—Ç 6: –û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç: —á—Ç–æ –∏–º–µ–Ω–Ω–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è
    """
    print("\n" + "="*80)
    print("üß™ –¢–ï–°–¢ 6: –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞")
    print("="*80)

    try:
        # –í–∞—à —Ç–µ—Å—Ç –∫–æ–¥
        assert condition, "‚ùå FAIL: –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã"
        print(f"\n‚úÖ PASS: –¢–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω —É—Å–ø–µ—à–Ω–æ")

    except AssertionError as e:
        print(f"\n‚ùå FAIL: {str(e)}")
        print(f"üìç –§–∞–π–ª: –ø—É—Ç—å/–∫/—Ñ–∞–π–ª—É.py")
        print(f"üìç –ú–µ—Ç–æ–¥: –Ω–∞–∑–≤–∞–Ω–∏–µ_–º–µ—Ç–æ–¥–∞()")
        raise
```

2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –Ω–æ–≤—ã–π —Ç–µ—Å—Ç:

```bash
pytest apps/simpleprint/tests/test_client.py::TestSimplePrintClient::test_06_my_new_test -v -s
```

## üéØ –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è

- ‚úÖ SimplePrint API –∫–ª–∏–µ–Ω—Ç
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ SimplePrint
- ‚úÖ Rate limiting (180 req/min)
- ‚úÖ Retry –ª–æ–≥–∏–∫–∞ (3 –ø–æ–ø—ã—Ç–∫–∏)
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ —Ñ–∞–π–ª–æ–≤ –∏ –ø–∞–ø–æ–∫
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ PostgreSQL
- ‚úÖ –°–≤—è–∑–∏ –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏ (ForeignKey)
- ‚úÖ REST API endpoints
- ‚úÖ Celery tasks
- ‚úÖ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (Token Auth)

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —Ç–µ—Å—Ç—ã –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—ã–≤–æ–¥ —Ç–µ—Å—Ç–∞ - —Ç–∞–º —É–∫–∞–∑–∞–Ω —Ç–æ—á–Ω—ã–π —Ñ–∞–π–ª –∏ —Å—Ç—Ä–æ–∫–∞ –æ—à–∏–±–∫–∏
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ `backend/logs/django.log`
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã (PostgreSQL, Redis, Celery)
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SimplePrint API –≤ `settings/base.py`

---

**–í–µ—Ä—Å–∏—è**: 1.0.0
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 2025-10-23
