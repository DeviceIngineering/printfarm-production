# SimplePrint Fixes v4.2.1 - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

## üìã –î–∞—Ç–∞: 2025-10-23
## üéØ –í–µ—Ä—Å–∏—è: 4.2.1

## üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. **–û—à–∏–±–∫–∞ –æ—Ç–º–µ–Ω—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏** ‚ùå ‚Üí ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –æ—Ç–º–µ–Ω–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞ "Not Found: /api/v1/simpleprint/sync/cancel/{task_id}/"

**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL pattern –¥–ª—è ViewSet action - `url_path='cancel/(?P<task_id>[^/.]+)'` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å DRF Router

**–†–µ—à–µ–Ω–∏–µ**:
```python
# –ë—ã–ª–æ (–ù–ï –†–ê–ë–û–¢–ê–õ–û):
@action(detail=False, methods=['post'], url_path='cancel/(?P<task_id>[^/.]+)')
def cancel_sync(self, request, task_id=None):
    ...

# –°—Ç–∞–ª–æ (–†–ê–ë–û–¢–ê–ï–¢):
@action(detail=False, methods=['post'], url_path='cancel')
def cancel_sync(self, request):
    task_id = request.data.get('task_id')
    ...
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
- `backend/apps/simpleprint/views.py:393-440` - –∏–∑–º–µ–Ω–µ–Ω endpoint –¥–ª—è –æ—Ç–º–µ–Ω—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- `frontend/src/store/simpleprintSlice.ts:128-134` - task_id —Ç–µ–ø–µ—Ä—å –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ —Ç–µ–ª–µ –∑–∞–ø—Ä–æ—Å–∞
- `frontend/src/pages/SimplePrintPage.tsx:149-155` - –æ–±–Ω–æ–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ API request

**URL**:
- –ë—ã–ª–æ: `POST /api/v1/simpleprint/sync/cancel/{task_id}/`
- –°—Ç–∞–ª–æ: `POST /api/v1/simpleprint/sync/cancel/` + body: `{"task_id": "..."}`

---

### 2. **–ó–∞–∫—Ä—ã—Ç–∏–µ –æ–∫–Ω–∞ –≤–æ –≤—Ä–µ–º—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏** ‚ö†Ô∏è ‚Üí ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞**: –û–∫–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∑–∞–∫—Ä—ã–≤–∞–ª–æ—Å—å –≤–æ –≤—Ä–µ–º—è –∞–∫—Ç–∏–≤–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫—Ä–µ—Å—Ç–∏–∫–∞, ESC –∏–ª–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –æ–∫–Ω–∞

**–†–µ—à–µ–Ω–∏–µ**: –û—Ç–∫–ª—é—á–µ–Ω—ã –≤—Å–µ —Å–ø–æ—Å–æ–±—ã –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –≤–æ –≤—Ä–µ–º—è –∞–∫—Ç–∏–≤–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

```typescript
<Modal
  title="–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å SimplePrint"
  open={syncModalVisible}
  closable={!syncing}         // ‚ùå –ö—Ä–µ—Å—Ç–∏–∫ (X) –æ—Ç–∫–ª—é—á–µ–Ω
  maskClosable={!syncing}     // ‚ùå –ö–ª–∏–∫ –≤–Ω–µ –æ–∫–Ω–∞ –æ—Ç–∫–ª—é—á–µ–Ω
  keyboard={!syncing}         // ‚ùå ESC –æ—Ç–∫–ª—é—á–µ–Ω
  onCancel={() => {
    if (syncing && currentTaskId) {
      Modal.confirm({
        title: '–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ',
        content: '–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ. –ó–∞–∫—Ä—ã—Ç—å –æ–∫–Ω–æ?',
        okText: '–î–∞, –∑–∞–∫—Ä—ã—Ç—å',
        cancelText: '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ',
        onOk: () => {
          setSyncModalVisible(false);
        },
      });
    } else {
      setSyncModalVisible(false);
    }
  }}
>
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
- `frontend/src/pages/SimplePrintPage.tsx:399-420` - –¥–æ–±–∞–≤–ª–µ–Ω—ã —Ç—Ä–∏ –Ω–æ–≤—ã—Ö —Å–≤–æ–π—Å—Ç–≤–∞ Modal

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
- ‚úÖ –ö—Ä–µ—Å—Ç–∏–∫ (X) –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- ‚úÖ –ö–ª–∏–∫ –≤–Ω–µ –æ–∫–Ω–∞ –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –µ–≥–æ
- ‚úÖ ESC –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –æ–∫–Ω–æ
- ‚úÖ –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∑–∞–∫—Ä—ã—Ç—å —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É "–ó–∞–∫—Ä—ã—Ç—å" –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ

---

### 3. **–ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è** üìä ‚Üí ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞**: –í–æ –≤—Ä–µ–º—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–∫–∞–∑—ã–≤–∞–ª "–ü–∞–ø–∫–∏: 0 / 0, –§–∞–π–ª—ã: 0 / 0"

**–ü—Ä–∏—á–∏–Ω–∞**: SimplePrint —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∏–º–µ–µ—Ç 2 —Ñ–∞–∑—ã:
1. **–§–∞–∑–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö** (~5 –º–∏–Ω—É—Ç): –†–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ –∏ –ø–∞–ø–æ–∫ –∏–∑ SimplePrint API —Å rate limiting (180 req/min)
2. **–§–∞–∑–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

`total_files` –∏ `total_folders` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ü–û–°–õ–ï –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ñ–∞–∑—ã 1.

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —Ñ–∞–∑—ã –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö

```typescript
// –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –µ—â–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è (total = 0)
if (total_files === 0 && total_folders === 0) {
  return [
    ...baseLog,
    `‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ SimplePrint API...`,
    `üì° –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç (rate limit: 180 req/min)`,
    `üîÑ Polling #${pollCount} [${timestamp}]`,
  ];
}

// –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
const progress = total_files > 0 ? Math.round((synced_files / total_files) * 100) : 0;
return [
  ...baseLog,
  `üìÅ –ü–∞–ø–∫–∏: ${synced_folders} / ${total_folders}`,
  `üìÑ –§–∞–π–ª—ã: ${synced_files} / ${total_files}`,
  `‚ö° –ü—Ä–æ–≥—Ä–µ—Å—Å: ${progress}%`,
  `üîÑ Polling #${pollCount} [${timestamp}]`,
];
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
- `frontend/src/pages/SimplePrintPage.tsx:78-96` - –¥–æ–±–∞–≤–ª–µ–Ω–æ —É—Å–ª–æ–≤–∏–µ –¥–ª—è —Ñ–∞–∑—ã –∑–∞–≥—Ä—É–∑–∫–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
- ‚úÖ –ü—Ä–∏ `total_files === 0`: –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è "‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ SimplePrint API..."
- ‚úÖ –ü—Ä–∏ `total_files > 0`: –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å "–§–∞–π–ª—ã: 350 / 1589"
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–Ω–∏–º–∞–µ—Ç —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–æ –≤—Ä–µ–º—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏

---

## üöÄ –î–µ–ø–ª–æ–π –∏–∑–º–µ–Ω–µ–Ω–∏–π

### Backend
```bash
# –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
scp -P 2132 backend/apps/simpleprint/views.py printfarm@kemomail3.keenetic.pro:~/factory_v3/backend/apps/simpleprint/

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ backend
ssh -p 2132 printfarm@kemomail3.keenetic.pro "docker restart factory_v3-backend-1"
```

### Frontend
```bash
# –°–±–æ—Ä–∫–∞
npm run build

# –°–æ–∑–¥–∞–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞ –∏ –¥–µ–ø–ª–æ–π
tar -czf /tmp/frontend-build.tar.gz -C build .
scp -P 2132 /tmp/frontend-build.tar.gz printfarm@kemomail3.keenetic.pro:/tmp/
ssh -p 2132 printfarm@kemomail3.keenetic.pro "
  docker cp /tmp/frontend-build.tar.gz factory_v3-nginx-1:/tmp/ &&
  docker exec factory_v3-nginx-1 sh -c 'rm -rf /usr/share/nginx/html/* && cd /usr/share/nginx/html && tar -xzf /tmp/frontend-build.tar.gz' &&
  docker restart factory_v3-nginx-1
"
rm /tmp/frontend-build.tar.gz
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–º–µ–Ω—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
# –í–æ –≤—Ä–µ–º—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –Ω–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "–û—Ç–º–µ–Ω–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é"
# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: —Å–æ–æ–±—â–µ–Ω–∏–µ "‚úÖ –ó–∞–¥–∞—á–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –æ—Ç–º–µ–Ω–µ–Ω–∞"
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –æ–∫–Ω–∞
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
# –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∑–∞–∫—Ä—ã—Ç—å –æ–∫–Ω–æ:
#   - –ù–∞–∂–∞—Ç—å –∫—Ä–µ—Å—Ç–∏–∫ (X) - –Ω–µ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å
#   - –ö–ª–∏–∫–Ω—É—Ç—å –≤–Ω–µ –æ–∫–Ω–∞ - –Ω–µ –¥–æ–ª–∂–Ω–æ –∑–∞–∫—Ä—ã–≤–∞—Ç—å
#   - –ù–∞–∂–∞—Ç—å ESC - –Ω–µ –¥–æ–ª–∂–Ω–æ –∑–∞–∫—Ä—ã–≤–∞—Ç—å
#   - –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "–ó–∞–∫—Ä—ã—Ç—å" - –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å—Å—è –¥–∏–∞–ª–æ–≥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —Å –≥–∞–ª–æ—á–∫–æ–π "–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è"
# –û–∂–∏–¥–∞–µ–º—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:
#   1. "‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ SimplePrint API..." - –ø–µ—Ä–≤—ã–µ ~5 –º–∏–Ω—É—Ç
#   2. "üìÅ –ü–∞–ø–∫–∏: 150 / 649" - –∫–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
#   3. "üìÑ –§–∞–π–ª—ã: 350 / 1589" - –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
#   4. "‚ö° –ü—Ä–æ–≥—Ä–µ—Å—Å: 22%" - –ø—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
```

---

## üìä –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### API Endpoints

#### Cancel Sync
```
POST /api/v1/simpleprint/sync/cancel/
Content-Type: application/json

{
  "task_id": "a881ca96-e619-4f2d-97a0-d8a9420801b9"
}

Response:
{
  "status": "cancelled",
  "task_id": "a881ca96-e619-4f2d-97a0-d8a9420801b9",
  "message": "–ó–∞–¥–∞—á–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –æ—Ç–º–µ–Ω–µ–Ω–∞"
}
```

#### Check Status
```
GET /api/v1/simpleprint/sync/status/{task_id}/

Response (–≤–æ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö):
{
  "task_id": "...",
  "state": "PENDING",
  "ready": false,
  "progress": {
    "total_files": 0,         // ‚Üê –ï—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
    "synced_files": 0,
    "total_folders": 0,       // ‚Üê –ï—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
    "synced_folders": 0
  }
}

Response (–ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö):
{
  "task_id": "...",
  "state": "STARTED",
  "ready": false,
  "progress": {
    "total_files": 1589,      // ‚Üê –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!
    "synced_files": 350,
    "total_folders": 649,     // ‚Üê –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!
    "synced_folders": 150
  }
}
```

### –§–∞–∑—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ SimplePrint

#### –§–∞–∑–∞ 1: –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö (5-10 –º–∏–Ω—É—Ç)
```python
# backend/apps/simpleprint/services.py
def fetch_all_files_and_folders_recursively():
    """
    –†–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –í–°–ï–• —Ñ–∞–π–ª–æ–≤ –∏ –ø–∞–ø–æ–∫ –∏–∑ SimplePrint API

    Rate limit: 180 req/min = 3 req/sec
    –í—Å–µ–≥–æ –ø–∞–ø–æ–∫: 649
    –í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤: 1589

    –í—Ä–µ–º—è: ~649 –∑–∞–ø—Ä–æ—Å–æ–≤ / 3 req/sec = ~216 —Å–µ–∫—É–Ω–¥ = ~4 –º–∏–Ω—É—Ç—ã
    """
    # total_files = 0 –Ω–∞ —ç—Ç–æ–π —Ñ–∞–∑–µ
    # total_folders = 0 –Ω–∞ —ç—Ç–æ–π —Ñ–∞–∑–µ
```

#### –§–∞–∑–∞ 2: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –ë–î (2-5 –º–∏–Ω—É—Ç)
```python
# backend/apps/simpleprint/services.py
def sync_all_files(full_sync=False):
    """
    –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

    1. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º total_files, total_folders
    2. –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–∞–ø–∫–∏ (–æ–±–Ω–æ–≤–ª—è–µ–º synced_folders)
    3. –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª—ã (–æ–±–Ω–æ–≤–ª—è–µ–º synced_files –∫–∞–∂–¥—ã–µ 50 —Ñ–∞–π–ª–æ–≤)
    """
    # total_files = 1589 —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!
    # total_folders = 649 —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!

    # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∫–∞–∂–¥—ã–µ 50 —Ñ–∞–π–ª–æ–≤
    if synced_count % 50 == 0:
        sync_log.synced_files = synced_count
        sync_log.save()
```

---

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: –û—Ç–º–µ–Ω–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –ª–æ–≥–∏**:
```bash
ssh -p 2132 printfarm@kemomail3.keenetic.pro "docker logs factory_v3-backend-1 --tail 50 | grep -i cancel"

# –û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
# INFO Attempting to cancel task: a881ca96-e619-4f2d..., state: STARTED
# INFO Updated sync log 8 status to cancelled
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ task_id**:
```bash
# –í –ª–æ–≥–∞—Ö —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# üì° API Request: POST /api/v1/simpleprint/sync/cancel/
# üìù Body: { task_id: "a881ca96..." }
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 0/0 —Å–ª–∏—à–∫–æ–º –¥–æ–ª–≥–æ

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Django shell**:
```bash
ssh -p 2132 printfarm@kemomail3.keenetic.pro "docker exec factory_v3-backend-1 python manage.py shell -c \"
from apps.simpleprint.models import SimplePrintSync
sync = SimplePrintSync.objects.filter(status='pending').first()
print(f'Total files: {sync.total_files}, Synced: {sync.synced_files}')
\""

# –ï—Å–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "Total files: 0", –∑–Ω–∞—á–∏—Ç –µ—â–µ –Ω–∞ —Ñ–∞–∑–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ Celery worker**:
```bash
ssh -p 2132 printfarm@kemomail3.keenetic.pro "docker logs factory_v3-celery-1 --tail 100 | grep -i 'fetching files'"

# –û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
# INFO Fetching files and folders for parent_id=16787
# INFO Fetched 25 folders and 150 files from parent_id=16787
```

---

## üìù –ò—Ç–æ–≥–∏ v4.2.1

‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ**:
1. –û—Ç–º–µ–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —á–µ—Ä–µ–∑ POST `/sync/cancel/`
2. –û–∫–Ω–æ –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –∞–∫—Ç–∏–≤–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
3. –ü—Ä–æ–≥—Ä–µ—Å—Å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º –≤–æ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö

üîß **–ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã**:
- `backend/apps/simpleprint/views.py` - –∏–∑–º–µ–Ω–µ–Ω endpoint –æ—Ç–º–µ–Ω—ã
- `frontend/src/store/simpleprintSlice.ts` - –∏–∑–º–µ–Ω–µ–Ω API call –¥–ª—è –æ—Ç–º–µ–Ω—ã
- `frontend/src/pages/SimplePrintPage.tsx` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç –∑–∞–∫—Ä—ã—Ç–∏—è –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–≥—Ä—É–∑–∫–µ

üì¶ **–î–µ–ø–ª–æ–π**:
- Backend: –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω docker container
- Frontend: –ø–µ—Ä–µ—Å–æ–±—Ä–∞–Ω –∏ –∑–∞–¥–µ–ø–ª–æ–µ–Ω —á–µ—Ä–µ–∑ nginx

---

**–í–µ—Ä—Å–∏—è**: 4.2.1
**–î–∞—Ç–∞**: 2025-10-23
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–µ–ø–ª–æ–µ–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
