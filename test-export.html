<!DOCTYPE html>
<html>
<head>
    <title>–¢–µ—Å—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞ Excel</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: #f5f5f5;
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            background: white; 
            padding: 20px; 
            border-radius: 8px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status { 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 4px; 
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button { 
            background: #06EAFC; 
            border: none; 
            padding: 10px 20px; 
            margin: 5px; 
            border-radius: 4px; 
            cursor: pointer; 
            font-weight: bold;
        }
        button:hover { background: #05d0e0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä –¢–µ—Å—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞ Excel - PrintFarm</h1>
        
        <div class="status info">
            <strong>–í—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏:</strong> <span id="timestamp"></span>
        </div>
        
        <h2>–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö:</h2>
        <button onclick="exportProducts()">–≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤</button>
        <button onclick="exportProductionList()">–≠–∫—Å–ø–æ—Ä—Ç —Å–ø–∏—Å–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞</button>
        <button onclick="testExportAPI()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å API —ç–∫—Å–ø–æ—Ä—Ç–∞</button>
        
        <div id="results"></div>
    </div>

    <script>
        document.getElementById('timestamp').textContent = new Date().toLocaleString('ru-RU');
        
        const resultsDiv = document.getElementById('results');
        
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong>: ${message}`;
            resultsDiv.appendChild(div);
        }
        
        function exportProducts() {
            log('–ó–∞–ø—É—Å–∫ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤...', 'info');
            
            const url = 'http://localhost:8000/api/v1/reports/export/products/';
            const link = document.createElement('a');
            link.href = url;
            link.download = `printfarm_products_${new Date().toISOString().split('T')[0]}.xlsx`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            log('‚úÖ –≠–∫—Å–ø–æ—Ä—Ç –∑–∞–ø—É—â–µ–Ω. –§–∞–π–ª –¥–æ–ª–∂–µ–Ω –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.', 'success');
        }
        
        function exportProductionList() {
            log('–ó–∞–ø—É—Å–∫ —ç–∫—Å–ø–æ—Ä—Ç–∞ —Å–ø–∏—Å–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞...', 'info');
            
            const url = 'http://localhost:8000/api/v1/reports/export/production-list/';
            const link = document.createElement('a');
            link.href = url;
            link.download = `printfarm_production_list_${new Date().toISOString().split('T')[0]}.xlsx`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            log('‚úÖ –≠–∫—Å–ø–æ—Ä—Ç —Å–ø–∏—Å–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ –∑–∞–ø—É—â–µ–Ω.', 'success');
        }
        
        async function testExportAPI() {
            log('–ü—Ä–æ–≤–µ—Ä–∫–∞ API —ç–∫—Å–ø–æ—Ä—Ç–∞...', 'info');
            
            try {
                // –¢–µ—Å—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞ —Ç–æ–≤–∞—Ä–æ–≤
                const response = await fetch('http://localhost:8000/api/v1/reports/export/products/', {
                    method: 'HEAD'  // –¢–æ–ª—å–∫–æ –∑–∞–≥–æ–ª–æ–≤–∫–∏
                });
                
                if (response.ok) {
                    const contentType = response.headers.get('Content-Type');
                    const contentLength = response.headers.get('Content-Length');
                    
                    log('‚úÖ API —ç–∫—Å–ø–æ—Ä—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç', 'success');
                    log(`üìÑ Content-Type: ${contentType}`, 'info');
                    log(`üìè –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: ${Math.round(contentLength / 1024)} KB`, 'info');
                    
                    if (contentType.includes('spreadsheetml')) {
                        log('‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç Excel —Ñ–∞–π–ª–∞', 'success');
                    } else {
                        log('‚ö†Ô∏è –ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Ç–∏–ø —Ñ–∞–π–ª–∞', 'error');
                    }
                } else {
                    log(`‚ùå API –≤–µ—Ä–Ω—É–ª —Å—Ç–∞—Ç—É—Å: ${response.status}`, 'error');
                    const text = await response.text();
                    log(`–û—à–∏–±–∫–∞: ${text}`, 'error');
                }
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ API: ${error.message}`, 'error');
            }
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = () => {
            setTimeout(testExportAPI, 1000);
        };
    </script>
</body>
</html>