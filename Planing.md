# Система планирования производства - Управление парком 3D принтеров

## Обзор проекта
Разработать веб-систему планирования производства для управления 27 3D-принтерами, работающими 24/7. Система помогает планировщику эффективно распределять задания печати между принтерами с учетом дневных/ночных смен и оптимизировать загрузку оборудования.

## Основные бизнес-требования

### Текущие проблемы
- Планировщик не помнит, что печаталось вчера
- Ручное отслеживание на бумаге приводит к ошибкам  
- Сложно оптимизировать ночную смену (20:00-8:00) для максимальной загрузки
- Нет видимости текущего прогресса печати
- Не видно критичных артикулов по уровню остатков

### Метрики успеха
- 100% загрузка ночной смены (принтеры работают без присмотра)
- Сокращение времени планирования с 1 часа до 10 минут в день
- Ноль забытых или дублированных заданий
- Реальное время видимости всех 27 принтеров

## Технический стек
- **Frontend**: React (или vanilla HTML/CSS/JS для простоты)
- **Интеграция API**: SimplePrint API  
- **Обновления в реальном времени**: Polling каждые 5 секунд (или WebSocket)
- **Хранение данных**: LocalStorage для планов, API для состояний принтеров
- **Часовой пояс**: GMT+3 (Московское время)

## Спецификация интерфейса

### Структура макета (1900px ширина)
```
┌─────────────────────────────────────────────────────────────┐
│              ЗАГОЛОВОК (Текущее время GMT+3)                │
├──────────────┬──────────────────────────────────────────────┤
│              │                                              │
│   ЛЕВАЯ      │         ЦЕНТРАЛЬНАЯ ПАНЕЛЬ                   │
│   ПАНЕЛЬ     │         (График загрузки)                    │
│   (400px)    │                                              │
│   Список     │   График на 48+ часов с принтерами           │
│   артикулов  │                                              │
│              │                                              │
├──────────────┴──────────────────────────────────────────────┤
│              НИЖНЯЯ ПАНЕЛЬ (Управление очередями)           │
│      Очередь дневной смены  |  Очередь ночной смены         │
└─────────────────────────────────────────────────────────────┘
```

## Спецификации компонентов

### 1. Левая панель - Склад артикулов (400px ширина)
```javascript
// Структура карточки артикула
{
  article_id: "N421-11-45K",          // Код артикула
  priority: "critical",                // critical | medium | low (критично | средне | низко)
  current_stock: 15,                   // штук на складе
  sales_2_months: 45,                  // продано за 2 месяца
  production_capacity: "30шт/6ч",      // макс. производительность
  material_color: "black",             // black | white | other (черный | белый | другой)
  currently_printing: 15,              // штук печатается СЕЙЧАС на всех принтерах
  queued_next_48h: 30                  // штук запланировано на 48 часов
}
```

**Функции:**
- Поле поиска для фильтрации артикулов
- Кнопки фильтров приоритета (Все/Критичные/Средние/Низкие)
- Drag & Drop для каждой карточки артикула
- Цветовые индикаторы приоритета
- Счетчики печати/очереди в реальном времени

### 2. Центральная панель - График загрузки

**Спецификации временной шкалы:**
- Ось X: Время от -4 часов до +48 часов
- Сетка: 80px на час (2160px общая ширина)
- Красная вертикальная линия "СЕЙЧАС" на позиции 320px (4 часа от начала)
- Зеленый фон для зоны "прошлое/печатается" (0-320px)

**Структура строки принтера:**
```javascript
{
  printer_id: "P1S-1",                 // ID принтера
  status: "printing",                  // printing | idle | error (печатает | ожидает | ошибка)
  material_color: "black",             // Цвет загруженного пластика
  current_task: {
    article: "N421-11-45K",            // Артикул
    quantity: 15,                      // Количество
    progress: 65,                      // Процент выполнения
    time_remaining: "1ч 20м",          // Осталось времени
    start_time: "2024-01-15T14:30:00", // Начало печати
    end_time: "2024-01-15T20:30:00"    // Планируемое окончание
  },
  queued_tasks: [...]                  // Очередь заданий
}
```

**Визуальные элементы:**
- Индикатор статуса (мигающая зеленая точка при печати)
- Название принтера и индикатор цвета материала
- Блоки задач с прогрессом для текущих печатей
- Зоны Drag & Drop для пустых временных слотов

### 3. Нижняя панель - Очереди смен

**Две колонки:**
- Дневная смена (8:00-20:00): Короткие задания под контролем оператора
- Ночная смена (20:00-8:00): Длинные задания для автономной печати

**Элемент очереди:**
```javascript
{
  article: "N421-11-45K",       // Артикул
  quantity: 30,                 // Количество
  estimated_time: "6ч 30м",      // Расчетное время
  assigned_printer: null,        // или ID принтера
  priority: "critical"          // Приоритет
}
```

## Критические функции для MVP

### Фаза 1: Основной функционал (Неделя 1)

1. **Статичный UI с тестовыми данными**
   - Отрисовка всех трех панелей
   - График с тестовыми заданиями
   - Карточки артикулов с mock данными

2. **Реализация Drag & Drop**
```javascript
   // Включить перетаскивание из карточек артикулов в:
   - Слоты временной шкалы принтеров
   - Панели очередей смен
   // Визуальная обратная связь при перетаскивании
   // Валидация зон сброса (совместимость цветов)
```

3. **Управление временем**
```javascript
   // Отображение часов в реальном времени (GMT+3)
   // Автопрокрутка графика к текущему времени
   // Расчеты длительности заданий
   // Процент прогресса для активных печатей
```

### Фаза 2: Интеграция API (Неделя 2)

4. **Подключение SimplePrint API**
```javascript
   // Необходимые endpoints:
   GET /api/printers        // Список всех принтеров со статусами
   GET /api/queue           // Текущая очередь печати
   GET /api/jobs/active     // Активные задания с прогрессом
   POST /api/queue/add      // Добавить задание в очередь
   DELETE /api/queue/{id}   // Удалить из очереди
   GET /api/inventory       // Уровни остатков артикулов
   GET /api/articles        // Спецификации артикулов
```

5. **Обновления в реальном времени**
```javascript
   // Опрос каждые 5 секунд
   setInterval(async () => {
     await updatePrinterStatuses();    // Обновить статусы принтеров
     await updateJobProgress();         // Обновить прогресс заданий
     await updateInventoryLevels();     // Обновить уровни остатков
   }, 5000);
```

### Фаза 3: Сохранение данных (Неделя 3)

6. **Сохранение планов**
```javascript
   // Сохранить текущий план в localStorage
   const plan = {
     timestamp: new Date().toISOString(),
     user: "имя_планировщика",
     queues: {...},      // Очереди
     assignments: {...}  // Назначения
   };
   localStorage.setItem(`plan_${Date.now()}`, JSON.stringify(plan));
```

7. **Отслеживание истории**
```javascript
   // Отслеживать завершенные задания
   // Показывать что печаталось вчера
   // Рассчитывать фактическое vs запланированное время
```

## Шаги реализации

### Шаг 1: Настройка проекта
```bash
# Создать React приложение
npx create-react-app production-planning
cd production-planning

# Установить зависимости
npm install axios date-fns react-beautiful-dnd

# Создать структуру папок
mkdir src/components src/services src/utils src/styles
```

### Шаг 2: Создать базовые компоненты
```jsx
// src/components/ProductionPlanning.jsx
import React, { useState, useEffect } from 'react';
import ArticlePanel from './ArticlePanel';
import Timeline from './Timeline';
import QueuePanel from './QueuePanel';

function ProductionPlanning() {
  const [articles, setArticles] = useState([]);
  const [printers, setPrinters] = useState([]);
  const [currentTime, setCurrentTime] = useState(new Date());
  
  // Логика компонента здесь
  
  return (
    <div className="production-container">
      <Header currentTime={currentTime} />
      <div className="main-layout">
        <ArticlePanel articles={articles} />
        <Timeline printers={printers} currentTime={currentTime} />
      </div>
      <QueuePanel />
    </div>
  );
}
```

### Шаг 3: Реализовать Drag & Drop
```jsx
// Используя react-beautiful-dnd
import { DragDropContext, Droppable, Draggable } from 'react-beautiful-dnd';

const onDragEnd = (result) => {
  const { source, destination, draggableId } = result;
  
  if (!destination) return;
  
  if (destination.droppableId.startsWith('printer-')) {
    // Добавить на график принтера
    assignToPrinter(draggableId, destination.droppableId);
  } else if (destination.droppableId === 'day-queue') {
    // Добавить в дневную смену
    addToDayShift(draggableId);
  }
};
```

### Шаг 4: Спецификации стилей
```css
/* Цвета темной темы */
:root {
  --bg-primary: #1a1a1a;       /* Основной фон */
  --bg-secondary: #2a2a2a;     /* Вторичный фон */
  --bg-tertiary: #333;          /* Третичный фон */
  --accent: #00d4ff;            /* Акцентный цвет */
  --success: #00ff44;           /* Успех/печать */
  --warning: #ffaa00;           /* Предупреждение/очередь */
  --error: #ff4444;             /* Ошибка */
  --text-primary: #e0e0e0;      /* Основной текст */
  --text-secondary: #aaa;       /* Вторичный текст */
}

/* Сетка графика */
.timeline {
  display: grid;
  grid-template-columns: repeat(27, 80px);
  background-image: repeating-linear-gradient(
    90deg,
    transparent,
    transparent 79px,
    #2a2a2a 79px,
    #2a2a2a 80px
  );
}

/* Маркер текущего времени */
.current-time-marker {
  position: absolute;
  left: 320px;
  width: 2px;
  background: var(--error);
  height: 100%;
  z-index: 100;
}

/* Визуализация задачи печати */
.print-task {
  background: linear-gradient(90deg, var(--success), #00cc33);
  border-radius: 4px;
  padding: 4px 8px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
}

.print-task.printing::after {
  content: '';
  position: absolute;
  bottom: 0;
  height: 3px;
  background: rgba(255,255,255,0.3);
  animation: progress-wave 2s linear infinite;
}
```

## Mock данные для разработки
```javascript
// src/services/mockData.js
export const mockPrinters = [
  {
    id: "P1S-1",
    status: "printing",
    color: "black",
    current_job: {
      article: "N421-11-45K",
      quantity: 15,
      progress: 65,
      time_remaining: "1ч 20м"
    }
  },
  // ... еще 26 принтеров
];

export const mockArticles = [
  {
    id: "N421-11-45K",
    name: "Адаптер номерной рамки",
    stock: 15,
    sales_2m: 45,
    capacity: "30шт/6ч",
    color: "black",
    priority: "critical",
    printing_now: 15,
    queued_48h: 30
  },
  // ... больше артикулов
];
```

## Сценарии тестирования

### Сценарий 1: Утреннее планирование
1. Открыть систему в 07:30
2. Проверить какие принтеры закончат до 08:00
3. Подготовить короткие задания для дневной смены
4. Перетащить 5-6 коротких заданий в дневную очередь

### Сценарий 2: Вечернее планирование  
1. Открыть систему в 19:00
2. Выбрать длительные задания (8-12 часов)
3. Назначить на принтеры для ночной печати
4. Обеспечить 100% загрузку принтеров на ночь

### Сценарий 3: Экстренное пополнение
1. Артикул показывает критический уровень (красный индикатор)
2. Перетащить на ближайший свободный принтер
3. Система рассчитывает время завершения
4. Уведомить склад о времени готовности

## Требования к производительности
- Загрузка страницы: < 2 секунд
- Отклик drag & drop: < 100мс
- Цикл обновления API: 5 секунд
- Поддержка 50+ артикулов в списке
- Обработка 27 принтеров одновременно
- Плавная прокрутка графика на 60 FPS

## Поддержка браузеров
- Chrome 90+ (основной)
- Firefox 88+
- Safari 14+
- Edge 90+

## Развертывание
```bash
# Сборка для продакшена
npm run build

# Деплой на сервер
scp -r build/* user@production-server:/var/www/planning/

# Или использовать Docker
docker build -t production-planning .
docker run -p 3000:3000 production-planning
```

## Будущие улучшения (Фаза 4+)
1. **AI оптимизация**: Предлагать оптимальное распределение заданий
2. **Мобильное приложение**: Для операторов обновлять статус печати
3. **Панель аналитики**: Статистика и тренды производства
4. **Предиктивное обслуживание**: Предупреждения о сбоях принтеров
5. **Портал для клиентов**: Показывать оценки завершения заказов
6. **Поддержка нескольких цехов**: Управление несколькими печатными фермами
7. **Интеграция с ERP**: Синхронизация с бизнес-системами
8. **Контроль качества**: Отслеживание и прогноз брака печати
9. **Расчет себестоимости**: Расчет стоимости производства в реальном времени
10. **Уведомления Slack/Teams**: Оповещения о завершении/ошибках

## Примеры данных с SimplePrint API

### Формат данных принтера
```json
{
  "id": "P1S-1",
  "name": "Принтер 1 (Черный)",
  "status": "printing",
  "material": {
    "color": "black",
    "type": "PLA",
    "remaining": 450
  },
  "current_job": {
    "id": "job_123",
    "article_id": "N421-11-45K",
    "quantity": 15,
    "started_at": "2024-01-15T14:30:00+03:00",
    "estimated_end": "2024-01-15T20:30:00+03:00",
    "progress": 65
  },
  "temperature": {
    "hotend": 215,
    "bed": 60
  }
}
```

### Формат данных артикула
```json
{
  "id": "N421-11-45K",
  "name": "Адаптер номерной рамки Geely Monjaro",
  "category": "Автотовары",
  "warehouse_stock": 15,
  "min_stock": 20,
  "max_stock": 100,
  "sales_stats": {
    "last_2_months": 45,
    "last_month": 22,
    "last_week": 8
  },
  "production": {
    "material": "black",
    "print_time_single": 72,
    "max_batch": 30,
    "support_required": false,
    "post_processing": "none"
  },
  "pricing": {
    "cost": 43.75,
    "retail": 135.5
  }
}
```

### Формат очереди печати
```json
{
  "queue_id": "queue_day_20240115",
  "shift": "day",
  "date": "2024-01-15",
  "items": [
    {
      "position": 1,
      "article_id": "N421-11-45K",
      "quantity": 15,
      "assigned_printer": null,
      "priority": "critical",
      "estimated_time": 360,
      "status": "pending"
    },
    {
      "position": 2,
      "article_id": "496-51850",
      "quantity": 6,
      "assigned_printer": "P1S-3",
      "priority": "medium",
      "estimated_time": 480,
      "status": "assigned"
    }
  ]
}
```

## Команды для запуска разработки
```bash
# Клонировать спецификацию в проект
curl -O https://raw.githubusercontent.com/[your-repo]/production-planning-spec-ru.md

# Инициализация с Claude Code
claude-code "Реализовать систему планирования производства согласно спецификации production-planning-spec-ru.md. Начать с настройки React и статичных UI компонентов"

# Добавить основные функции
claude-code "Добавить функциональность drag and drop для артикулов на график принтеров используя react-beautiful-dnd"

# Интегрировать API
claude-code "Подключить SimplePrint API и реализовать обновления в реальном времени"

# Добавить сохранение планов
claude-code "Реализовать сохранение и загрузку планов производства в localStorage"

# Оптимизация для ночной смены
claude-code "Добавить автоматические рекомендации для оптимальной загрузки ночной смены с учетом длительности печати"
```

## Чек-лист готовности к запуску

### Минимальный функционал (MVP)
- [ ] Отображение 27 принтеров на графике
- [ ] Список артикулов с остатками и приоритетами
- [ ] Drag & Drop артикулов на график
- [ ] Красная линия текущего времени
- [ ] Отображение прогресса печати
- [ ] Очереди дневной и ночной смен
- [ ] Обновление данных каждые 5 секунд
- [ ] Сохранение плана в localStorage

### Расширенный функционал
- [ ] Интеграция с SimplePrint API
- [ ] История выполненных заданий
- [ ] Экспорт отчетов
- [ ] Уведомления о завершении
- [ ] Мобильная версия
- [ ] Аналитика производства

## Контакты и поддержка
- SimplePrint API документация: https://docs.simpleprint3d.com
- React документация: https://ru.reactjs.org
- Сообщить о проблеме: github.com/yourcompany/production-planning/issues
- Техподдержка: support@yourcompany.ru

---

Эта спецификация содержит всё необходимое для создания системы планирования 3D-печати готовой к промышленной эксплуатации. Начните с Фазы 1 и итерируйте на основе обратной связи пользователей.